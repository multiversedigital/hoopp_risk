# Tab 2: Limit Monitor - è®¾è®¡æ–‡æ¡£

## 1. ä¸šåŠ¡ç›®æ ‡

å±•ç¤ºåŸºé‡‘çš„**åˆè§„é™é¢ç›‘æ§**çŠ¶æ€ï¼Œè®©é£é™©ç»ç†ä¸€çœ¼çœ‹åˆ°ï¼š
- å“ªäº›é™é¢æ¥è¿‘æˆ–çªç ´é˜ˆå€¼
- FX æ•å£æ˜¯å¦è¶…é™
- å•ä¸€å‘è¡Œäººé›†ä¸­åº¦é£é™©

è¿™æ˜¯å…»è€é‡‘åŸºé‡‘ IP&G (Investment Policy & Guidelines) çš„æ ¸å¿ƒç›‘æ§åœºæ™¯ã€‚

---

## 2. UI å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Total Limits]  [Breaches]  [Warnings]  [FX Exposure %]        â”‚  â† Row 1: 4ä¸ª KPI å¡ç‰‡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚                               â”‚
â”‚   ğŸ“Š Limits Status Table        â”‚   ğŸ¯ FX Exposure Gauge        â”‚  â† Row 2: å·¦å®½å³çª„ (6:4)
â”‚   (çº¢ç»¿ç¯è¡¨ï¼Œ8è¡Œ)                â”‚   (ä»ªè¡¨ç›˜ï¼Œ15% é˜ˆå€¼)           â”‚
â”‚                                 â”‚                               â”‚
â”‚   Asset Class | Actual | Target â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚   Fixed Income | 42% | 42% âœ…   â”‚                               â”‚
â”‚   Equities | 39% | 38% ğŸŸ¡       â”‚   ğŸ“‹ Top 5 Issuers            â”‚
â”‚   FX Exposure | 16% | 15% ğŸ”´    â”‚   (é›†ä¸­åº¦è¡¨)                   â”‚
â”‚   ...                           â”‚                               â”‚
â”‚                                 â”‚                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   ğŸ“ˆ Funded Status & FX Trend (æ—¶é—´åºåˆ—ï¼ŒåŒYè½´)                  â”‚  â† Row 3: æ»¡å®½
â”‚   â”€â”€ Funded Status (å·¦è½´)  â”€â”€ FX % (å³è½´)  â”€â”€â”€ 15% Limit        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ç»„ä»¶è¯¦è§£

### Row 1: KPI å¡ç‰‡ (4ä¸ª)

| æŒ‡æ ‡ | æ•°æ®æº | è¯´æ˜ |
|------|--------|------|
| Total Limits | `len(limits_df)` | ç›‘æ§çš„é™é¢æ€»æ•° (8ä¸ª) |
| Breaches ğŸ”´ | `limits_df[Status == 'BREACH'].count()` | çªç ´æ•°é‡ |
| Warnings ğŸŸ¡ | `limits_df[Status == 'WARN'].count()` | é¢„è­¦æ•°é‡ |
| FX Exposure | `ctx['fx_pct']` | å½“å‰ FX æ•å£å æ¯” |

### Row 2 å·¦: Limits Status Table

| åˆ— | è¯´æ˜ |
|----|------|
| Limit Name | é™é¢åç§° (Fixed Income, Equities, FX, Funded Status...) |
| Actual | å½“å‰å€¼ (ç™¾åˆ†æ¯”æ ¼å¼) |
| Target | æ”¿ç­–ç›®æ ‡å€¼ |
| Range | [Min, Max] å…è®¸èŒƒå›´ |
| Status | ğŸŸ¢ OK / ğŸŸ¡ WARN / ğŸ”´ BREACH |

**åˆ¤æ–­é€»è¾‘ï¼š**
```
if actual > max OR actual < min:
    â†’ ğŸ”´ BREACH
elif actual > max Ã— 0.9 OR actual < min Ã— 1.1:
    â†’ ğŸŸ¡ WARN (æ¥è¿‘è¾¹ç•Œ)
else:
    â†’ ğŸŸ¢ OK
```

### Row 2 å³ä¸Š: FX Gauge ä»ªè¡¨ç›˜

- **å½“å‰å€¼**: `ctx['fx_pct']` (~12-16%)
- **é˜ˆå€¼çº¿**: 15% (çº¢çº¿)
- **é¢œè‰²åŒºé—´**: 
  - ç»¿åŒº: 0-12%
  - é»„åŒº: 12-15%
  - çº¢åŒº: >15%

### Row 2 å³ä¸‹: Top 5 Issuers è¡¨

| Issuer | Weight | Status |
|--------|--------|--------|
| Government of Canada | 8.2% | ğŸŸ¢ OK |
| RBC | 4.8% | ğŸŸ¢ OK |
| ... | | |

**å•ä¸€å‘è¡Œäººé™é¢**: 5% (ä¿å®ˆå€¼)

### Row 3: æ—¶é—´åºåˆ—å›¾ (åŒYè½´)

- **å·¦Yè½´**: Funded Status (100%-115%)
- **å³Yè½´**: FX Exposure % (0%-20%)
- **çº¿æ¡**:
  - Funded Status (å†°è“ #00b4d8)
  - FX % (ç°è“ #8a9bb0)
- **é˜ˆå€¼çº¿**:
  - 111% Funded Status ç›®æ ‡ (ç»¿è‰²è™šçº¿)
  - 15% FX Limit (çº¢è‰²è™šçº¿)

---

## 4. æ•°æ®æ¥æº (ä» ctx è·å–)

| UI ç»„ä»¶ | ctx é”® | å·²æœ‰? |
|---------|--------|-------|
| KPI å¡ç‰‡ | `limits_df`, `fx_pct` | âœ… |
| çº¢ç»¿ç¯è¡¨ | `ctx['limits_df']` | âœ… |
| FX Gauge | `ctx['fx_pct']` | âœ… |
| Top 5 Issuers | `ctx['issuer_df']` | âœ… |
| æ—¶é—´åºåˆ— | `ctx['time_series_df']` | âœ… |

**engine.py éœ€ä¿®æ”¹**: `_build_limits_df()` ä¸­çš„ WARN åˆ¤æ–­é€»è¾‘

---

## 5. é¢œè‰²è§„èŒƒ

| å…ƒç´  | é¢œè‰² |
|------|------|
| é¡µé¢èƒŒæ™¯ | `#0f1923` |
| å¡ç‰‡èƒŒæ™¯ | `#162232` |
| ä¸» Accent | `#00b4d8` (å†°è“) |
| Funded Status çº¿ | `#00b4d8` |
| FX % çº¿ | `#8a9bb0` |
| ğŸŸ¢ OK | `#00c9a7` |
| ğŸŸ¡ WARN | `#f9a825` |
| ğŸ”´ BREACH | `#e74c3c` |
| Threshold çº¿ | `#e74c3c` (çº¢è‰²è™šçº¿) |

---

## 6. å®ç°æ¸…å•

- [x] è®¾è®¡æ–‡æ¡£
- [ ] `tabs/tab_limit_monitor.py` - render å‡½æ•°
- [ ] `engine.py` - æ›´æ–° `_build_limits_df()` WARN é€»è¾‘
- [ ] `app.py` - å–æ¶ˆæ³¨é‡Š import å’Œ render è°ƒç”¨

---

## 7. äº®ç‚¹

| ç‚¹ | ä»·å€¼ |
|----|------|
| çº¢ç»¿ç¯ä¸€ç›®äº†ç„¶ | é£é™©ç»ç† 5 ç§’å†…çŸ¥é“æœ‰æ²¡æœ‰é—®é¢˜ |
| FX Breach äº‹ä»¶ | æ•°æ®é‡Œ 1/27 é‚£å¤©æœ‰ FX çªç ´ï¼Œå›¾ä¸Šä¼šæ˜¾ç¤º |
| åŒ Y è½´æ—¶é—´åºåˆ— | åŒæ—¶çœ‹ Funded Status å’Œ FXï¼Œå‘ç°ç›¸å…³æ€§ |
| å•ä¸€å‘è¡Œäººç›‘æ§ | å±•ç¤ºé›†ä¸­åº¦é£é™©ç®¡ç†èƒ½åŠ› |
